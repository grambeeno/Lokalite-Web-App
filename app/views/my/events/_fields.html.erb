<% organization = form.object.organization %>

<%= form.inputs do %>
  <li>
    <%= form.error_messages %>
  </li>

  <%= form.hidden_field :organization_id, :value => organization.id %>
  <%= form.input :name %>
  <%= form.input :description, :as => :text, :hint => raw('<span id="counter"></span>'), :input_html => {:rows => 2} %>
  <%= form.input :starts_at, :as => :string, :input_html => {:value => form.object.starts_at.to_s(:datetimepicker), :class => 'datetimepicker'} %>
  <%= form.input :ends_at,   :as => :string, :input_html => {:value => form.object.ends_at.to_s(:datetimepicker), :class => 'datetimepicker'} %>
  <%= form.input :repeating, :label => 'This is a repeating event', :hint => raw('<br />Set repeat dates after you submit this form') %>
  <%= form.input :first_category, :label => 'Categories', :required => true, :as => :select, :collection => EVENT_CATEGORIES, :prompt => 'Select a Category' %>
  <%= form.input :second_category, :label => '&nbsp;', :as => :select, :collection => EVENT_CATEGORIES, :include_blank => 'Second Category (optional)' %>

  <%= form.input :image, :as => :radio, :collection => organization.event_images, :label_method => Proc.new {|image| image_tag(image.url(:thumb)) } %>
  <script type="text/javascript">
    jQuery(document).ready(function($) {
      $('#event_image_input ol').prepend(
          '<li><label for="new_event_image"><input id="new_event_image" name="event[image_id]" type="radio" value="new" /> <img alt="New Image" src="/images/upload-new-image.png" /></label></li>'
      );

    <% if organization.event_images.any? && !form.object.new_record? %>
      $('#event_image_attributes_image_input').hide();
    <% else -%>
      $('#new_event_image').click();
    <% end %>
    });
  </script>

  <%= form.semantic_fields_for :image, EventImage.new do |image| %>
    <%= image.hidden_field :organization_id, :value => organization.id %>
    <%= image.input :image, :as => :file, :hint => 'Square, at least 300x300. Non-square images will be cropped.', :label => '&nbsp;', :required => false %>
  <% end %>

  <%#= form.input :image, :as => :file, :hint => 'Square, at least 300x300' %>
  <li class='align-with-fields'>
  </li>
  <%#= form.hidden_field :image_cache %>

  <%= form.input :location, :collection => organization.locations, :label_method => :short_identifier, :include_blank => false %>
<% end %>

<%= form.inputs :class => 'new-location' do %>
  <%= form.semantic_fields_for :location, Location.new(:region => 'CO', :organization_id => organization.id), :class => 'new-location' do |location| %>
    <%= location.hidden_field :organization_id, :value => organization.id %>
    <%= render :partial => '/shared/location_fields', :locals => {:form => location} %>
  <% end %>
<% end %>

<%= form.buttons %>

<script type="text/javascript">
  jQuery(document).ready(function($) {

    $('#event_image_input :radio').change(function(){
      if ($(this).val() === 'new') {
        $('#event_image_attributes_image_input').slideDown()
      } else {
        $('#event_image_attributes_image_input').slideUp()
      }
    });

    ////////
    $('#event_location_id').append('<option value="new">Create a new location</option>');

    $('.new-location').hide()
    $('#event_location_id').change(function(){
      if ($(this).val() === 'new') {
        $('.new-location').slideDown()
      } else {
        $('.new-location').slideUp()
      }
    });


  });
</script>

